variable v getenv "V"
variable g getenv "G"
log log.lammps_ver$v_gew$g

# trial numbers:
# V 0 = conp/v0
# V 1 = conp, ksp_style pppm
# V 2 = conp, ksp_style pppm/conp
# V 3 = conp pppm, ksp_style pppm/conp
# gewald numbers:
# G 0 = auto
# G 1 = 0.15
# G 2 = 0.25
# G 3 = 0.35

units real
dimension 3
newton off
processors * * 2
boundary p p f
atom_style full

## force field
pair_style lj/cut/coul/long 16.0
pair_modify mix arithmetic
bond_style harmonic
angle_style harmonic

if "$v >= 2" then "kspace_style pppm/conp 1.0e-7" else "kspace_style pppm 1.0e-7"
if "$g == 0" then "kspace_modify slab 3.0" &
elif "$g == 1"    "kspace_modify slab 3.0 gewald 0.15" &
elif "$g == 2"    "kspace_modify slab 3.0 gewald 0.25" &
elif "$g == 3"    "kspace_modify slab 3.0 gewald 0.35"

## atom definition
read_data data

variable molleft  equal 641
variable molright equal 642

neigh_modify one 3000
group sol type 1:4
variable q atom q
variable etype equal 5
group ele           type ${etype}
group eleleft       molecule ${molleft}
group eleright      molecule ${molright}

compute qleft       eleleft  reduce sum v_q
compute qright      eleright reduce sum v_q
compute tempsl      sol      temp

run_style           verlet
timestep            2
velocity ele set 0.0 0.0 0.0
variable p equal 1.0

if "$v == 0" then &
"fix e all conp/v0 1 1.979 ${molleft} ${molright} -${p} ${p} inv iter" &
elif "$v == 1 || $v == 2" &
"fix e all conp 1 1.979 ${molleft} ${molright} -$p $p inv iter etypes 1 ${etype}" &
elif "$v == 3" &
"fix e all conp 1 1.979 ${molleft} ${molright} -$p $p inv iter etypes 1 ${etype} pppm"

variable t equal 500
group bmi type 1:3
fix bmishake bmi shake 0.0001 10 0 t 1 2 3 b 1 2 a 1

fix 1 sol nvt temp $t $t 100.0
thermo_style custom step temp c_tempsl c_qleft c_qright
thermo 20
run 500


