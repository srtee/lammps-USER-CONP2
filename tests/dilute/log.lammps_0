
# trial numbers:
# 0 = conp/v0
# 1 = conp/v1
# 2 = conp/v2
# 3 = conp/v3
# 4 = conp/v4
# 5 = conp/v4 etypes
# 6 = conp/v4 etypes ffield
# 7 = conp/v4 etypes noslab zneutr

units               real
dimension           3
newton              off
#processors          * * 2
if "$n <= 5" then "boundary p p f" else "boundary p p p"
boundary p p f
atom_style          full

##force field
pair_style          lj/cut/coul/long 4.0
bond_style          harmonic
angle_style         harmonic
kspace_style        pppm 1.0e-6
if "$n <= 5" then "kspace_modify slab 3.0"
kspace_modify slab 3.0

##atom definition
read_data           data
Reading data file ...
  orthogonal box = (0.0000000 0.0000000 -44.200000) to (9.8380000 8.5200000 44.200000)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  432 atoms
  scanning bonds ...
  2 = max bonds/atom
  scanning angles ...
  1 = max angles/atom
  reading bonds ...
  160 bonds
  reading angles ...
  80 angles
Finding 1-2 1-3 1-4 neighbors ...
  special bond factors lj:    0.0      0.0      0.0     
  special bond factors coul:  0.0      0.0      0.0     
     2 = max # of 1-2 neighbors
     1 = max # of 1-3 neighbors
     1 = max # of 1-4 neighbors
     2 = max # of special neighbors
  special bonds CPU = 0.000 seconds
  read_data CPU = 0.008 seconds
pair_coeff   1   1         0.09935850       3.40000000  # CAB CAB
pair_coeff   1   2         0.19419428       3.50000000  # CAB CAC
pair_coeff   1   3         0.07390356       3.38500000  # CAB CG
pair_coeff   1   4         0.09935850       3.35000000  # CAB NAA
pair_coeff   2   2         0.37954900       3.60000000  # CAC CAC
pair_coeff   2   3         0.14444310       3.48500000  # CAC CG
pair_coeff   2   4         0.19419428       3.45000000  # CAC NAA
pair_coeff   3   3         0.05497000       3.37000000  # CG CG
pair_coeff   3   4         0.07390356       3.33500000  # CG NAA
pair_coeff   4   4         0.09935850       3.30000000  # NAA NAA

##replicate cell if noslab zneutr
if "$n == 7" then "replicate 1 1 2" "change_box all z final $(-lz/2) $(lz/2) remap units box" "region pos block EDGE EDGE EDGE EDGE 0 EDGE" "group pos region pos" "variable newz atom lz/2-z" "set group pos z v_newz" "variable molmax   equal 82" "variable molleft  equal 81" "variable molright equal 82" "set mol $(v_molmax+v_molright) mol ${molleft} " "set mol $(v_molmax+v_molleft)  mol ${molright}"

##setting
neighbor            2 bin
group sol type 1 2 4
240 atoms in group sol
compute tempsl      sol      temp
variable q atom q
group ele           type 3
192 atoms in group ele
group eleleft       molecule 81
96 atoms in group eleleft
group eleright      molecule 82
96 atoms in group eleright
if "$n != 7" then "group eleall        union eleleft eleright" "compute qleft       eleleft  reduce sum v_q" "compute qright      eleright reduce sum v_q" "compute qall        eleall   reduce sum v_q" elif "$n == 7" "group elepos  intersect ele   pos" "group eleneg  subtract  ele   elepos" "group eleleftpos  intersect eleleft   pos" "group elerightpos intersect eleright  pos" "group eleleftneg  subtract  eleleft   eleleftpos" "group elerightneg subtract  eleright  elerightpos" "compute qleftpos       eleleftpos  reduce sum v_q" "compute qleftneg       eleleftneg  reduce sum v_q" "compute qrightpos      elerightpos reduce sum v_q" "compute qrightneg      elerightneg reduce sum v_q" "compute qpos           elepos      reduce sum v_q" "compute qneg           eleneg      reduce sum v_q"
group eleall        union eleleft eleright
192 atoms in group eleall
compute qleft       eleleft  reduce sum v_q
compute qright      eleright reduce sum v_q
compute qall        eleall   reduce sum v_q

run_style           verlet
timestep            1
velocity ele set 0.0 0.0 0.0
fix 0 ele setforce 0.0 0.0 0.0

if "$n == 0" then "fix e all conp/v0 1 1.979 81 82 -0.5 0.5 inv iter" elif "$n == 1"  "fix e all conp/v1 1 1.979 81 82 -0.5 0.5 inv iter" elif "$n == 2"  "fix e all conp/v2 1 1.979 81 82 -0.5 0.5 inv iter" elif "$n == 3"  "fix e all conp/v3 1 1.979 81 82 -0.5 0.5 inv iter" elif "$n == 4"  "fix e all conp/v4 1 1.979 81 82 -0.5 0.5 inv iter" elif "$n == 5"  "fix e all conp/v4 1 1.979 81 82 -0.5 0.5 inv iter etypes 1 3" elif "$n == 6"  "fix e all conp/v4 1 1.979 81 82 -0.5 0.5 inv iter etypes 1 3 ffield" "fix efield all efield 0 0 $(-1.0/lz) " elif "$n == 7"  "fix e all conp/v4 1 1.979 81 82 -0.5 0.5 inv iter etypes 1 3 noslab zneutr"
fix e all conp/v0 1 1.979 81 82 -0.5 0.5 inv iter

fix 1 sol nvt temp 298.0 298.0 100.0
if "$n != 7" then "thermo_style custom step temp c_tempsl c_qleft c_qright c_qall" elif "$n == 7" "thermo_style custom step temp c_tempsl c_qleftneg c_qrightneg c_qneg c_qrightpos c_qleftpos c_qpos"
thermo_style custom step temp c_tempsl c_qleft c_qright c_qall
thermo              10
run 200
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:328)
  G vector (1/distance) = 0.76872648
  grid = 27 24 324
  stencil order = 5
  estimated absolute RMS force accuracy = 0.0004048351
  estimated relative force accuracy = 1.2191489e-06
  using double precision MKL FFT
  3d grid and FFT values/proc = 434910 209952
Neighbor list info ...
  update every 1 steps, delay 10 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 6
  ghost atom cutoff = 6
  binsize = 3, bins = 4 3 30
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut/coul/long, perpetual
      attributes: half, newton off
      pair build: half/bin/newtoff
      stencil: half/bin/3d/newtoff
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 42.95 | 42.95 | 42.95 Mbytes
Step Temp c_tempsl c_qleft c_qright c_qall 
       0            0            0            0            0            0 
      10    872.55487    1573.5195  0.028650838 -0.049334222 -0.020683384 
      20    1009.3175      1820.15   0.02947291 -0.048264946 -0.018792036 
      30    960.38476    1731.9073  0.022567882 -0.036893272  -0.01432539 
      40    877.23495    1581.9593  0.016514656 -0.027315125 -0.010800469 
      50    818.60466    1476.2285 0.0014379041 -0.0092217367 -0.0077838326 
      60    745.40659     1344.227   -0.0127227 0.0053247073 -0.0073979928 
      70    724.53004    1306.5793 -0.027929492  0.019140596 -0.0087888961 
      80    667.01892    1202.8667 -0.039085748  0.029054824 -0.010030924 
      90    640.51256    1155.0666 -0.041281312  0.028740971 -0.012540341 
     100    603.94191     1089.117 -0.040869194  0.023611502 -0.017257692 
     110    564.84856    1018.6181 -0.033605162  0.013282733 -0.020322429 
     120    526.64259    949.71948 -0.028819515 0.0057401161 -0.023079399 
     130    524.60026    946.03645 -0.027214401 0.0029534535 -0.024260948 
     140    481.15129    867.68287 -0.028791905 0.0025792303 -0.026212675 
     150    436.84025    787.77468 -0.027728649 0.0025367637 -0.025191886 
     160     391.5768    706.14896 -0.024664284 -0.00050388152 -0.025168165 
     170    390.01668    703.33552 -0.022402707 -0.0011875249 -0.023590232 
     180    365.04213    658.29774 -0.022506506 6.8490732e-05 -0.022438016 
     190    340.63013    614.27442 -0.024283229 0.0034975263 -0.020785702 
     200    334.70278    603.58534 -0.025861132 0.0052759393 -0.020585193 
Loop time of 65.1227 on 1 procs for 200 steps with 432 atoms

Performance: 0.265 ns/day, 90.448 hours/ns, 3.071 timesteps/s
193.6% CPU use with 1 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.088511   | 0.088511   | 0.088511   |   0.0 |  0.14
Bond    | 0.0070438  | 0.0070438  | 0.0070438  |   0.0 |  0.01
Kspace  | 30.503     | 30.503     | 30.503     |   0.0 | 46.84
Neigh   | 0.0098951  | 0.0098951  | 0.0098951  |   0.0 |  0.02
Comm    | 0.00507    | 0.00507    | 0.00507    |   0.0 |  0.01
Output  | 0.042185   | 0.042185   | 0.042185   |   0.0 |  0.06
Modify  | 34.463     | 34.463     | 34.463     |   0.0 | 52.92
Other   |            | 0.003453   |            |       |  0.01

Nlocal:        432.000 ave         432 max         432 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:        1863.00 ave        1863 max        1863 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:        18308.0 ave       18308 max       18308 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 18308
Ave neighs/atom = 42.379630
Ave special neighs/atom = 1.1111111
Neighbor list builds = 5
Dangerous builds = 0
Total wall time: 0:03:22
